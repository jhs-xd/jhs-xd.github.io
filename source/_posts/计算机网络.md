---
title: 计算机网络
copyright: true
categories: 
  - 《计算机网络》
tags: 
  - Internet

---
<blockquote class="blockquote-center">Genius only means hard-working all one's life. ——Mendeleyev
![](/myimages/16.jpg)

<!-- more -->

---

# 概述 #

1. 网络（network）：若干结点和连接这些结点的链路组成（网络中结点可以是计算机、集线器、交换机、路由器）
2. 互联网：通过路由器把网络和网络连接起来，互联网是“网络的网络”
3. 因特网：世界上最大的互联网（网络把计算机连接在一起，因特网把网络连接在一起）

		1.因特网发展的三个阶段
		第一阶段：单个网络ARPANET——>Internet
		第二阶段：建成三级结构的互联网（主干网、地区网、校园网/企业网）
		第三阶段：形成多层次ISP（Internet Service Provider）结构的因特网

		2.ISP：因特网服务提供商，ISP从因特网管理机构申请到很多IP地址，同时拥有通信线路和路由器等连网设备。
		
		3.ISP多层结构
		（1）根据覆盖面积和拥有IP数目的大小，ISP分为三层：主干ISP、地区ISP、本地ISP
		（2）主机A要和主机B通信，需要依次经过本地ISPa、地区ISPa、主干ISPa，
		主干ISPb、地区ISPb、本地ISPb一层层传输
		（3）IXP：因特网交换点，它允许两个网络直接相连并交换分组，不需要通过第三个网络转发分组

		4.上网：通过某个ISP获得IP，将用户主机通过ISP接入因特网

		5.因特网的组成
		（1）边缘部分：主机
		（2）核心部分：大量网络+路由器
		边缘部分利用核心部分提供的服务，使众多主机之间能够互相通信并交换、共享信息

		6.路由器
		实现分组交换（动态分配传输线路的资源），转发收到的分组
		分组交换采用存储转发技术，将要发送的报文划分为等长的数据包/分组

		7.计算机之间的通信：主机A的某个进程和主机B上的另一个进程进程通信
		通信方式：
		（1）C/S：客户服务器方式
		（2）P2P：对等方式

4. “三网”：电信网络、计算机网络、有线电视网络
5. 计算机网络的分类
		（1）广域网WAN（因特网的核心部分）：长距离传输数据
		（2）城域网MAN
		（3）局域网LAN：多个互联的局域网组成校园网/企业网
6. 计算机网络的性能指标
		（1）速率：单位bit/s
		（2）带宽：通信线路允许通过的信号频带范围；表示通信线路传输数据的能力，即单位时间内通信线路所能通过的“最高数据率”
		（3）吞吐量：单位时间内通过某个网络的数据量（受带宽限制）
		（4）时延：总时延=排队时延+处理时延+发送时延+传播时延，提高数据的发送速率只是减小了数据的发送时延
		（5）时延带宽积：表示从发送端发出但尚未到达接收端的比特
		（6）往返时间RTT：表示从发送方发送数据开始，到发送方收到接收方的确认，总经历的时间
		（7）利用率：信道利用率——某信道有百分之几的时间是被利用的
				    网络利用率——全网络信道利用率的加权平均值
					信道或网络利用率过高会产生非常大的时延
7. 计算机网络的体系结构
		1.协议
		网络通信的规则，规则明确规定了：数据格式、同步问题（时序问题）
		2.体系结构
		计算机网络的各层及其协议的集合称为网络的体系结构
		3.具有五层协议的体系结构
		（1）OSI的七层协议
		OSI是由国际标准化组织制定的标准，它概念清楚，理论完善，但是复杂又不实用。
			7    应用层
			6    表示层
			5    会话层
			4    运输层
			3    网络层
			2    数据链路层
			1    物理层
		（2）TCP/IP的四层协议
		TCP/IP体系结构得到了非常广泛的应用
			4    应用层(各种应用层协议如HTTP，FTP，DNS等)
			3    运输层(TCP或UDP)
			2    网际层(又名网络互联层)
			1    数据链路层(又名网络接口层)
		（3）五层协议
		学习网络原理时的体系结构，结合OSI和TCP/IP的优点
			5    应用层（进程间通信和交互的规则，如HTTP，FTP等）
			4    运输层（为进程间的通信提供通用的数据传输服务，如TCP,UDP）
			3    网络层（为分组交换网上的不同主机提供通信服务，选择合适的路由，通过路由器找到目的主机，IP协议）
			2    数据链路层（将IP数据报组装成帧在链路上传送，每一帧包括数据和控制信息——同步信息、地址信息、差错控制信息）
			1    物理层
8. 数据在各层之间的传递
		（1）协议数据单元PDU
		计算机网络体系结构中，对等层之间交换的信息报文统称为协议数据单元（Protocol Data Unit，PDU）
		PDU由协议控制信息（协议头）和数据（SDU）组成
		（2）各层PDU的名称
				应用层 —— 报文（Message）
				传输层 —— 段（Segment）
				网络层 —— 分组/包（Packet）
				数据链路层 —— 帧（Frame）
				物理层 —— 比特（Bit）
		（3）PDU的封装
		在计算机网络体系结构中，下层把上层的PDU作为本层的数据加以封装，然后增加本层的协议头部（和尾部）形成本层的PDU

![](/myimages/16PDU数据的封装.png)

下图为TCP/IP协议对于PDU的封装：

![](/myimages/16PDU封装实例.png)

---

# 物理层 #
1. 数据通信系统的模型
一个数据通信系统分为三大部分：源系统、传输系统、目的系统

![](/myimages/16数据通信系统模型.png)

		（1）源系统
		源点：要传输的数据
		发送器：源点数据要经过发送器编码（基带调制）后才能在传输系统中传输
		典型的发送器是调制器

		（2）目的系统
		接收器：接收传输系统传过来的信号，解调为能被目的设备处理的信息
		典型的接收器是解调器
		终点：获取传输过来的数字比特流，把信息输出
2. 宽带接入技术
用户要连接到Internet，必须先连接到某个ISP，获取上网所需的IP
（1）初期，利用电话线通过调制解调器连接到ISP（最高速率达到56kb/s）
（2）如今，多种宽带接入技术
		1.ADSL技术
		（1）ADSL：非对称数字用户线，用数字技术对现有的模拟电话线进行改造，使它能够承载宽带数字业务

		（2）原理：在电话线的两端各安装一个ADSL调制解调器（我国采用离散多音调DMT调制技术实现）
		相当于在电话线上使用许多小的调制解调器并行地传送数据
		由于用户电话线的具体条件（距离、线径、干扰等）差别很大，所以ADSL不能保证固定的数据率
		ADSL采用自适应调制技术使用户线能够传送尽可能高的数据率

		（3）“非对称”的含义：ADSL的下行（从ISP到用户）带宽远远大于上行（从用户到ISP）带宽

		（4）ADSL的传输距离取决于：数据速率（速率越快传输距离越短）、电话线的线径（越细衰减越大）

---

# 数据链路层 #
1. 数据链路层的信道：点对点信道、广播信道
2. 数据链路层协议的任务：
		（1）封装成帧：在一段数据的前后添加首部和尾部，构成一帧
		（2）透明传输：当传送的帧使用文本文件组成的帧，数据部分不会出现帧定界控制字符，不论键盘输入什么都可以在帧中传输过去，称为透明传输
			字节填充法解决透明传输问题（发送端的数据链路层，在数据中出现控制字符时，需要在前面插入一个转义字符）
		（3）差错检测：在数据链路层才能广泛使用循环冗余检验CRC的检错技术
			凡是接收端数据链路层接受的帧均无差错

---

# 网络层 #
1. 与IP协议配套的三个协议：
-  地址解析协议ARP（将网络层的IP地址解析为数据链路层的硬件地址）
-  网际控制报文协议ICMP
-  网际组管理协议IGMP

![](/myimages/16IP及其配套协议.png)

2. IP地址
IP地址是给因特网上每一个主机（或路由器）的每一个接口分配一个唯一的32位的标识符

3. IP地址的分类如下：

![](/myimages/16IP地址的分类.png)

		（1）IP地址=网络号+主机号
			网络号：标志主机（或路由器）所连接的网络
			主机号：标志网络号范围内的主机
		（2）IP地址不仅指明一个主机，也指明了主机所连接的网络
		（3）IP地址采用点分十进制记法
		（4）A类地址的网络号占1个字节，主机号占3个字节
			因此每一个A类网络中可指派的最大网络数为2^7-2，减2的原因：全0表示本网络，127（即01111111）保留作为本地软件环回测试本主机的进程之间的通信
			最大主机数为2^24-2，减2的原因：全0代表“本主机”，全1表示该网络上的所有主机

4. IP地址的特点
		（1）每一个IP地址都由网络号和主机号两部分组成。IP地址是一种 分等级的地址结构。分两个等级的好处是：
			1>IP地址管理机构在分配IP地址时只分配网络号（第一级），而剩下的主机号（第二级）则由得到该网络号的单位自行分配
			2>路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目的主机号），这样就可以使路由表中的项目数大幅度减少，
			从而减小了路由表所占的存储空间以及查找路由表的时间

		（2）实际上IP地址是标志一个主机（或路由器）和一条链路的接口。由于一个路由器至少应当连接到两个网络，因此一个路由器至少应当有两个不同的IP地址。

		（3）用转发器或网桥连接起来的若干个局域网仍为一个网络，因为这些局域网都具有同样的网络号。
			具有不同网络号的局域网必须使用路由器进行互连
			即：
			1>同一个局域网上的主机或路由器的IP地址中的网络号必须一致
			2>路由器总是有两个或两个以上的IP地址，即路由器的每一个接口都有一个不同网络号的IP地址

		（4）在IP地址中，所有分配到网络号的网络（不管是范围很小的局域网，还是可能覆盖很大地理范围的广域网）都是平等的

5. IP地址与硬件地址
		（1）硬件地址/物理地址/MAC地址：数据链路层和物理层使用的地址，位于MAC帧的首部
		（2）IP地址：网络层和以上各层使用的地址，是一种逻辑地址。位于IP数据报的首部
		（3）因此在数据链路层，只能看见MAC帧，不能看见IP数据报（IP地址）

6. 划分子网
在ARPANET的早期，IP地址的设计确实不够合理：
 -  IP地址空间的利用率有时很低
 -  给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏
 -  两级IP地址不够灵活
 
 为解决上述问题，进行**划分子网**：在IP地址中又增加了一个“子网号字段＂，使两级IP地 址变成为**三级IP地址**（网络号+子网号+主机号）

	**注意：**划分子网只是把IP地址的主机号这部分进行再划分，不改变网络号

7. 子网掩码
标志是否对主机号进行了子网划分
因特网规定：所有的网络都必须有子网掩码，不划分子网时，使用各类IP对应的默认子网掩码

![](/myimages/16子网掩码.png)

**三级IP地址的子网掩码**和数据报的**目的IP地址**逐位相“与”，得到子网的网络地址

8. 路由表的内容：使用子网划分后，路由表必须包含三项内容——目的网络地址、子网掩码、下一跳地址

---

# 传输层 #
1. 网络层与传输层的区别
		（1）网络层为主机之间提供逻辑通信
			传输层为进程之间提供端到端的逻辑通信
		（2）在网络层，IP数据报首部中的检验和字段， 只检验首部是否出现差错而不检查数据部分
			运输层还要对收到的报文进行差错检测

2. 传输层的两个主要协议
		TCP：传输控制协议，面向连接
		UDP：用户数据报协议，无连接

使用UDP和TCP协议的各种应用和应用层协议：
![](/myimages/16TCP和UDP应用.png)

3. 传输层的端口
		（1）把一个特定机器上运行的特定进程指明为因特网上通信最后的终点还是不可行的。
			这是因为进程的创建和撤销都是动态的，通信的一方几乎无法识别对方机器上的进程。
		（2）为解决上述问题，引入运输层的端口。
			虽然通信的终点是应用进程，但我们只要把要传送的报文交到目的主机的某一个合适的目的端口，
			剩下的工作（即最后交付给目的进程）就由TCP来完成
		（3）TCP/IP的运输层用一个16位端口号来标志一个端口

4. 用户数据报协议UDP
		（1）UDP只在IP的数据报服务之上增加了很少一点的功能，这就是复用和分用的功能以及差错检测的功能

		（2）UDP的主要特点：
			1> UDP是无连接的
			2> UDP使用尽最大努力交付，即不保证可靠交付
			3> UDP是面向报文的
				发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付给IP层。UDP对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。
			4> UDP没有拥塞控制
				因此网络出现的拥塞不会使源主机的发送速率降低。
			5> UDP支持一对一、一对多、多对一和多对多的交互通信
			6> UDP的首部开销小，只有8个字节，比TCP的20个字节的首部要短

		（3）UDP的首部格式
			首部字段由4个字段、8个字节组成，每个字段2个字节
			1> 源端口：在需要对方回信时选用，不需要时可用全0
			2> 目的端口：这在终点交付报文时必须要使用到
			3> 长度：UDP用户数据报的长度，其最小值是8 (仅有首部）
			4> 检验和：检测UDP用户数据报在传输中是否有错，有错就丢弃（首部和数据部分一起检验）

5. 传输控制协议TCP
		（1）TCP的主要特点：
			1>  TCP是面向连接的运输层协议
				应用程序在使用TCP协议之前，必须先建立TCP连接；在传送数据完毕后，必须释放已经建立的TCP连接
			2> 每一条TCP连接只能有两个端点（一对一，点对点）
			3> TCP提供可靠交付的服务
				通过TCP连接传送的数据，无差错、不丢失、不重复、并且按序到达
			4> TCP提供全双工通信
				TCP允许通信双方的应用进程在任何时候都能发送数据。
				TCP连接的两端都设有发送缓存和接收缓存，用来临时存放双向通信的数据
			5> 面向字节流
				TCP把应用程序交下来的数据看成仅仅是一连串的无结构的字节流，TCP并不知道所传送的字节流的含义。

		（2）TCP的连接
			1> TCP面向连接，每条TCP连接有两个端点，端点称为套接字Socket
			2> 套接字Socket=IP:端口号
			3> 每一条TCP连接唯一地被通信两端的两个端点（即两个套接字）所确定

		（3）TCP可靠传输原理
			通过可靠传输协议实现：
			1> 停止等待协议（自动重传请求ARQ）
				“停止等待”就是每发送完一个分组就停止发送，等待对方的确认；在收到确认后再发送下一个分组。

				a.超时重传（发送方出错）
				若传输过程中出现差错，接收方不会返回确认信息，发送方超过一段时间未收到确认，就会进行“超时重传”
				注意：
					第一，发送方在发送完一个分组后，必须暂时保留已发送的分组的副本（为发生超时重传时使用）
					第二，分组和确认分组都必须进行编号
					第三，超时计时器设置的重传时间应当比数据在分组传输的平均往返时间更长一些
				
				b.确认丢失（接收方出错）
				接收方的确认丢失了，发送方就会进行超时重传，但事实上接收方已经接收到了数据
				接收方需要做：
				第一，丢弃这个重复的分组M2,不向上层交付
				第二，向发送方重新发送确认

			经过上述的确认和重传机制，就可以在不可靠的传输网络上实现可靠的通信
			
			注意：停止等待协议信道利用率极低
				 为提高传输效率，采用流水线传输
				 流水线传输就是发送方可连续发送多个分组，不必每发完一个分组就停顿下来等待对方的确认

			2> 连续ARQ协议/滑动窗口协议（流水线传输）
			发送方分组发送：位于窗口中的多个分组都可以连续发出去，不需要等待对方确认
			接收方累积确认：接收方不必对收到的分组逐个发送确认，而是可以在收到几个分组后，对按序到达的最后一个分组发送确认

超时重传：
![](/myimages/16超时重传.png)

确认丢失：
![](/myimages/16确认丢失和确认迟到.png)

		（4）TCP的首部格式
			首部占：20+4n字节，其中20个字节是固定的，4n字节根据需要增加

			首部各字段：
			1> 源端口、目的端口
			2> 序号：在一个TCP连接中传送的字节流中的每一个字节都按顺序编号
			3> 确认号：期望收到对方下一个报文段的第一个数据字节的序号
			4> 数据偏移：这个字段实际上是指出TCP报文段的首部长度
			5> 保留：占6位，保留为今后使用，但目前应置为0
			6> 紧急URG：URG=1标志该报文段中包含紧急数据，应尽快发送
			7> 确认ACK：TCP规定，在连接建立后所有传送的报文段都必须把ACK置l
			8> 推送PSH
			9> 复位RST
			10> 同步SYN：建立连接时的标志。
				当SYN=1而ACK=0时，表明这是一个连接请求报文段。
				对方若同意建立连接，则应在响应的报文段中使SYN=1和ACK=1
				因此，SYN置为1就表示这是个连接请求或连接接受报文
			11> 终止FIN：用来释放一个连接
				当FIN=1时，表明此报文段的发送方的数据已发送完毕， 并要求释放运输连接
			12> 窗口：窗口指的是发送本报文段的一方的接收窗口（而不是自己的发送窗口）
				窗口值作为接收方让发送方设置其发送窗口的依据
			13> 检验和：检验和字段检验的范围包括首部和数据这两部分
			14> 紧急指针：紧急指针仅在URG = 1时才有意义，它指出本报文段中的紧急数据的字节数（紧急数据结束后就是普通数据）
			15> 选项

		（5）TCP可靠传输的实现
			以字节为单位的滑动窗口
			超时重传
			选择确认SACK

		（6）TCP的流量控制
			让发送方的发送速率不要太快，要让接收方来得及接收
			发送方的发送窗口不能超过接收方给出的接收窗口的数值（TCP的窗口单位是字节，不是报文段）

		（7）TCP的拥塞控制

		（8）TCP的运输连接管理
			运输连接的三个阶段：连接建立，数据传送，连接释放
			
6. TCP“三次握手，四次挥手”
（1）TCP的连接建立——三次握手
![](/myimages/16三次握手建立TCP连接.png)

		准备工作：
		1.客户主动打开连接、服务器被动打开连接
		2.B的TCP服务器进程先创建传输控制块TCB上，准备接受客户进程的连接请求。
		  然后服务器进程就处于LISTEN收听状态，等待客户的连接请求。如有，即作出响应

		第一次握手：
		A的TCP客户进程也是首先创建传输控制模块TCB,然后向B发出连接请求报文段
		这时首部中的同步位SYN=1，同时选择一个初始序号seq=x
		这时，TCP客户进程进入SYN-SENT（同步已发送）状态

		第二次握手：
		B收到连接请求报文段后，如同意建立连接，则向A发送确认。
		在确认报文段中应把SYN位和ACK位都置1，确认号是ack=x+1，同时也为自己选择一个初始序号seq=y
		这时TCP服务器进程进入SYN-RCVD（同步收到）状态

		第三次握手：
		TCP客户进程收到B的确认后，还要向B给出确认。
		确认报文段的ACK置1，确认号ack=y+1，而自己的序号seq=x+l
		这时，TCP连接已经建立，A进入ESTABLISHED（已建立连接）状态
		当B收到A的确认后，也进入ESTABLISHED状态
		第三次握手可以携带HTTP请求报文

		问题：为什么最后A还要在发送一次确认？
		答：A不想欺骗B，让服务器B一直建立着连接，等着A发送数据。事实上，A此时并没有建立连接请求。
			这是由于很久之前A的连接请求在某些网络节点长时间滞留了，A在此期间重传了一次新的连接请求，完成了TCP连接和数据传输。
			等到滞留的旧的连接请求抵达服务器端B，A已经释放了客户端的连接。

（2）TCP的连接释放——四次挥手
![](/myimages/16四次挥手.png)

		第一次挥手：
		A的应用进程先向其TCP发出连接释放报文段，并停止再发送数据，主动关闭TCP连接。
		A把连接释放报文段首部的FIN置1,其序号seq=u
		这时A进入FIN-WAIT-1(终止等待1)状态，等待B的确认

		第二次挥手：
		B收到连接释放报文段后即发出确认，确认号是ack=u+1，而这个报文段自己的序号是v
		B就进入CLOSE-WAIT（关闭等待）状态
		A收到来自B的确认后，就进入FIN-WAIT-2C终止等待2)状态，等待B发出的连接释放报文段
		此时，TCP连接处于半关闭(half-close)状态：A到B的连接关闭，但B到A的连接仍开启。即A已经没有数据要发送了，但B若发送数据，A仍要接收

		第三次挥手：
		B发出的连接释放报文段必须使FIN=1，B还必须重复上次已发送过的确认号ack=u+1
		这时B就进入LAST-ACK（最后确认）状态，等待A的确认

		第四次挥手：
		A在收到B的连接释放报文段后，必须对此发出确认。
		在确认报文段中把ACK置1，确认号ack=w+1，而自己的序号是seq=u+l
		A进入到TIME-WAIT（时间等待）状态

		注意：现在TCP连接还没有释放掉。必须经过时间等待计时器(TIME-WAITtimer)设置的时间2MSL后，A才进入到CLOSED状态（时间MSL叫做最长报文段寿命）

		当A撤销相应的传输控制块TCB后，就结束了这次的TCP连接
		B只要收到了A发出的确认，就进入CLOSED状态
		同样，B在撤销相应的传输控制块TCB后，就结束了这次的TCP连接（B结束TCP连接的时间要比A早一些）

---

# 应用层 #
1. 域名系统DNS
域名系统DNS(Domain Name System)是因特网使用的命名系统，用来把便于人们使用的机器名字转换为IP地址
（1）域名到IP地址的解析是由分布在因特网上的许多域名服务器程序（可简称为域名服务器）共同完成的
（2）DNS的分布式结构
**树状结构的DNS域名服务器**

![](/myimages/16树状结构的DNS域名服务器.png)

每一个域名服务器都只对域名体系中的一部分进行管辖

		根据域名服务器所起的作用，可以把域名服务器划分为以下四种不同的类型：
		1> 根域名服务器
		2> 顶级域名服务器TLD
		3> 权限域名服务器
		4> 本地域名服务器

2. 万维网 WWW
（1）万维网是一个大规模的、联机式的信息储藏所，英文简称为Web
（2）万维网以客户服务器方式工作
客户程序向服务器程序发出请求，服务器程序向客户程序送回客户所要的万维网文档
（3）怎样标志分布在整个因特网上的万维网文档？
万维网使用**统一资源定位符URL**来标志万维网上的各种文档，并使每个文档在整个因特网的范围内具有唯的标识符URL
（4）用什么样的协议来实现万维网上各种链接？
万维网客户程序与万维网服务器程序之间的交互遵守**超文本传送协议HTTP**
（5）怎样使不同作者创作的不同风格的万维网文档都能在因特网上的各种主机上显示出来？
万维网使用**超文本标记语言HTML**, 使得万维网页面的设计者可以很方便地用链接从本页面的某处链接到因特网上的任何个万维网页面，并且能够在自己的主机屏幕上将这些页面显示出来
